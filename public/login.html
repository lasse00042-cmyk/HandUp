<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/png" href="favicon.png">
<link rel="manifest" href="./manifest.json">
<title>HandUp - Login</title>
<style>
  body {
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: #f6f7fb;
    transition: background 0.3s, color 0.3s;
    color: #1a1a1a;
  }

  .card {
    background: #fff;
    width: min(420px, 90vw);
    padding: 32px 24px;
    border-radius: 20px;
    box-shadow: 0 12px 28px rgba(0,0,0,0.12);
    text-align: center;
    position: relative;
    transition: background 0.3s, color 0.3s;
  }

  h1 { margin-bottom: 24px; font-size: 1.75rem; }

  form { display: grid; gap: 16px; }

  input {
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s, background 0.3s;
  }

  input:focus {
    border-color: #6b7bff;
    box-shadow: 0 0 8px rgba(107,123,255,0.2);
  }

.password-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.password-wrapper input {
  width: 100%;
  padding-right: 40px; /* Platz f√ºr den Show/Hide Button */
}

.toggle-pass {
  position: absolute;
  right: 12px;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  color: #6b7bff;
  height: 100%;
}

  button {
    padding: 12px 16px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
  }

  button:hover { transform: scale(1.03); }
  button:active { transform: scale(0.97); }

  .login-btn { background: #6b7bff; color: white; }
  .register-btn { background: #6b7aff4d; color: white; border: 1px solid #6b7bff; }
  .register-btn:hover { background: #6b7aff96; }

  .msg { font-size: 0.9rem; margin-top: 6px; }
  .msg.ok { color: #0a7a30; }
  .msg.error { color: #b00020; }

  .forgot-pass {
    font-size: 0.85rem;
    color: #6b7bff;
    text-decoration: underline;
    cursor: pointer;
    text-align: right;
  }

  #settingsBtn {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 8px 12px;
    border-radius: 12px;
    border: none;
    background: #6b7bff;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.1s, background 0.2s;
  }
  #settingsBtn:hover { transform: scale(1.05); }
  #settingsBtn:active { transform: scale(0.97); }

  .modal {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.5);
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .hidden { display:none; }
  .modal-content {
    background: white;
    color: black;
    padding: 24px;
    border-radius: 16px;
    min-width: 280px;
    text-align: center;
    transition: background 0.3s, color 0.3s, transform 0.3s;
    transform: translateY(-10px);
  }
  .modal.show .modal-content { transform: translateY(0); }

  body.dark {
    background: #1e1e1e;
    color: #f5f5f5;
  }
  body.dark .card { background: #2a2a2a; color: #f5f5f5; }
  body.dark input { background: #333; color: #f5f5f5; border: 1px solid #555; }
  body.dark input:focus { border-color: #9aa2ff; box-shadow: 0 0 8px rgba(154,162,255,0.2); }
  body.dark .modal-content { background: #2a2a2a; color: #f5f5f5; }
</style>
</head>
<body>

<button id="settingsBtn">‚öôÔ∏è Settings</button>

<div class="card">
  <h1>Login</h1>
  <form id="loginForm">
    <input id="email" name="email" type="email" placeholder="E-Mail" required />
    <div class="password-wrapper">
      <input id="password" name="password" type="password" placeholder="Passwort" required />
      <button type="button" class="toggle-pass">üëÅÔ∏è</button>
    </div>
    <div class="forgot-pass" onclick="alert('Funktion folgt üòâ')">Passwort vergessen?</div>
    <button type="submit" class="login-btn">Einloggen</button>
    <button type="button" class="register-btn" onclick="location.href='index.html'">Registrieren</button>
    <div id="msg" class="msg"></div>
  </form>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal hidden">
  <div class="modal-content">
    <h2>Theme</h2>
    <label><input type="radio" name="theme" value="light"> Light Mode</label><br>
    <label><input type="radio" name="theme" value="dark"> Dark Mode</label><br><br>
    <button id="closeModal">Schlie√üen</button>
  </div>
</div>

<script>
  // Dark Mode initial
  if(localStorage.getItem('theme') === 'dark'){
    document.body.classList.add('dark');
  }

  const form = document.getElementById('loginForm');
  const msg = document.getElementById('msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = 'Pr√ºfe ‚Ä¶';
    msg.className = 'msg';

    const payload = { email: form.email.value.trim(), password: form.password.value };
    try {
      const res = await fetch('/login', { 
        method: 'POST', 
        headers: { 'Content-Type': 'application/json' }, 
        body: JSON.stringify(payload) 
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);

      localStorage.setItem('userId', data.user.id);
      localStorage.setItem('userName', data.user.name);
      localStorage.setItem('userEmail', data.user.email);

      window.location.href = '/subjects.html';
    } catch (err) {
      msg.textContent = '‚ùå ' + (err.message || 'Fehler beim Login');
      msg.className = 'msg error';
    }
  });

  // Show/Hide Passwort
  const togglePassBtn = document.querySelector('.toggle-pass');
  const passwordInput = document.getElementById('password');
  togglePassBtn.addEventListener('click', () => {
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      togglePassBtn.textContent = 'üôà';
    } else {
      passwordInput.type = 'password';
      togglePassBtn.textContent = 'üëÅÔ∏è';
    }
  });

  // Settings Modal
  const settingsBtn = document.getElementById('settingsBtn');
  const modal = document.getElementById('settingsModal');
  const closeModal = document.getElementById('closeModal');
  const themeRadios = document.querySelectorAll("input[name='theme']");

  settingsBtn.addEventListener("click", ()=> modal.classList.remove("hidden"));
  closeModal.addEventListener("click", ()=> modal.classList.add("hidden"));

  themeRadios.forEach(radio => {
    radio.addEventListener("change", ()=> {
      if(radio.value === "dark"){
        document.body.classList.add("dark");
        localStorage.setItem("theme","dark");
      } else {
        document.body.classList.remove("dark");
        localStorage.setItem("theme","light");
      }
    });
  });

  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    document.querySelector("input[value='dark']").checked = true;
  } else if (savedTheme === "light") {
    document.body.classList.remove("dark");
    document.querySelector("input[value='light']").checked = true;
  } else {
    document.body.classList.add("dark");
    document.querySelector("input[value='dark']").checked = true;
    localStorage.setItem("theme", "dark");
  }
</script>
</body>
</html>
